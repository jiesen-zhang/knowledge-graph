,sentences
0,policies_cleanAbstract.
1,The Internet has quickly evolved into a vast global network owned and operated by thousands of different administrative entities.
2,"During this time, it became apparent that vanilla shortest-path routing would be insufficient to handle the myriad operational, economic, and political factors involved in routing."
3,"ISPs began to modify routing configurations to support routing policies, i.e. goals held by the router’s owner that controlled which routes were chosen and which routes were propagated to neighbors."
4,"BGP, originally a simple path-vector protocol, was incrementally modified over time with a number of mechanisms to support policies, adding substantially to the complexity."
5,Much of the mystery in BGP comes not only from the protocol complexity but also from a lack of understanding of the underlying policies and the problems ISPs face which they address.
6,"In this paper we shed light on goals operators have and their resulting routing policies, why BGP evolved the way it did, and how common policies are implemented using BGP."
7,We also discuss recent and current work in the field that aims to address problems that arise in applying and supporting routing policies.
8,1 Introduction.
9,"In the early days of the Internet, the problem of how to route packets to their final destination was much simpler than it is today."
10,"At the time, the requirements of the Internet’s routing protocol were fairly simple, as the Internet was small by today’s standards, operated by a single administrative entity (NSFNET), and shortest-path routing was typically used."
11,"Over time, as the Internet became more heavily commercialized and privatized, Internet Service Providers (ISPs) began to have vested interests in controlling the way traffic flowed for economic and political reasons."
12,The Border Gateway Protocol (BGP) was born out of the need for ISPs to control route selection (where to forward packets) and propagation (who to export routes to).
13,"When BGP was first introduced, it was a fairly simple path vector protocol."
14,"Over time, many incremental modifications to allow ISPs to control routing were proposed and added to BGP."
15,The end result was a protocol weighted down with a huge number of mechanisms that can overlap and conflict in various unpredictable ways.
16,"These modifications can be highly mysterious since many of them, including the decision process used to select routes, are not part of the protocol specification."
17,"Moreover, their complexity gives rise to several key problems, including unforeseen security vulnerabilities, widespread misconfiguration, and conflicts between policies at different ISPs."
18,"Addressing BGP’s problems is difficult, as changing certain aspects of BGP (for example changing the contents of update  messages or the way they are propagated) must be coordinated and simultaneously implemented in other ISPs to support the new design."
19,Hence most modifications to the protocol have been made to the decision process BGP uses to choose routes.
20,"The result is a protocol where most of the complexity is in the decision process and the policies used to influence decisions, while the rest of the protocol remained fairly simple over time."
21,"Therefore, in order to understand BGP it is necessary to understand this decision process and the policies of ISPs that gave rise to its design."
22,"Understanding policies is also key to solving BGP’s problems, understanding measurement data from BGP, or determining what features to support when developing a new version of BGP."
23,The range of policies used by operators constitutes a huge space and hence it is impossible to list them all here.
24,"Instead, we try to list common goals of network operators and the knobs of BGP that can be used to express policies."
25,"In particular, we attempt to isolate certain design patterns commonly used by ISPs, the motivations behind them, and how they are implemented in an ISP’s network using BGP’s mechanisms."
26,"We taxonomize policies into four general categories: business relationship policy (Section 3) arising from economic or political relationships an ISP has with its neighbor, traffic engineering policy (Section 4) arising from the need to control traffic flow within an ISP and across peering links to avoid congestion and provide good service quality, policies for scalability (Section 5) to reduce control traffic and avoid overloading routers, and security-related policies (Section 6) that are often used to protect an ISP against malicious or accidental attacks."
27,We also discuss several avenues of research currently in progress related to BGP policies (Section 7).
28,We start by giving an overview of BGP routing in the next section.
29,2 BGP routing in a single AS.
30,The Internet consists of thousands of Autonomous Systems (ASes)—networks that are each owned and operated by a single institution.
31,BGP is the routing protocol used to exchange reachability information across ASes.
32,"Usually each ISP operates one AS, though some ISPs may operate multiple ASes for business reasons ( to provide more autonomy to administrators of an ISP’s backbones in the United States and Europe) or historical reasons ( a recent merger of two ISPs)."
33,Non-ISP businesses (enterprises) may also operate their own ASes so as to gain the additional routing flexibility that arises from participating in the BGP protocol.
34,"Compared to enterprise networks, ISPs usually have more complex policies arising from the fact that they often have several downstream customers, connect to certain customers in multiple geographic locations, have complex traffic engineering goals, and run BGP on internal routers (rather than just border    routers as enterprises often do)."
35,"Although some of the observations we make apply to enterprise networks, our core focus in this paper is on ISP networks."
36,"In this section, we describe BGP from the standpoint of a single AS, describing first the protocol that transmits routes from one AS to another, then the decision process used to choose routes, and finally the mechanisms used at routers to implement policy."
37,2.1 Exchanging routing state.
38,Figure 1 shows a simple BGP network.
39,BGP sessions are established between border routers that reside at the edges of an AS and border routers in neighboring ASes.
40,These sessions are used to exchange routes between neighboring ASes.
41,Border routers then distribute routes learned on these sessions to nonborder (internal) routers as well as other border routers in the same AS using internal-BGP (iBGP).
42,"In addition, the routers in an AS usually run an Interior Gateway Protocol (IGP) to learn the internal network topology and compute paths from one router to another."
43,Each router combines the BGP and IGP information to construct a forwarding table that maps each destination prefix to one or more outgoing links along shortest paths through the network to the chosen border router.
44,BGP is a relatively simple protocol with a few salient features.
45,"First, BGP is an incremental protocol, where after a complete routing table is exchanged between neighbors, only changes to that information are exchanged."
46,"These changes may be new route advertisements, route withdrawals, or changes to route attributes."
47,"Second, BGP is a path-vector protocol where advertisements contain a list of ASes used to reach the destination."
48,"Third, routes are advertised at the prefix level, so an AS would send a separate update for each of its reachable prefixes."
49,"Fourth, BGP update messages may contain several fields, including a list of prefixes being advertised, a list of prefixes being withdrawn, and a list of route attributes that describe various characteristics of each advertised route."
50,"An ISP implements its policies by modifying route attributes and changing the way routers react to advertisements with certain route attributes, as discussed below."
51,2.2 Selecting a route at a router.
52,A BGP router in an ISP may have several alternate routes to reach a particular destination.
53,"In the absence of policy, the router would choose the route with the minimum pathlength, with some arbitrary way to break ties between routes with the same pathlength."
54,"However, in order to give operators greater control over route selection, several additional attributes were added to advertisements, allowing a router to alter its decisions based on the values of these attributes."
55,"The end result is the BGP decision process, consisting of an ordered list of attributes across which routes are compared, as shown in Table 1."
56,"The router goes down the list, comparing each attribute in the list across the two routes."
57,"If the routes have different values for the attribute, the router chooses the one that has the more desirable attribute, otherwise it moves on to compare the next attribute in the list."
58,The route that is chosen is used by the router to forward packets.
59,The ordering of attributes allows the operator to influence various stages of the decision process.
60,"For example, the Local Preference (LocalPref) is the first step in the decision process."
61,"By changing LocalPref, an operator can force a route with a longer AS path to be chosen over a shorter one."
62,"As another example, the Multi-Exit Discriminator (MED) is typically used by two ASes connected by multiple links to indicate which peering link should be used to reach the AS advertising the attribute."
63,"MED was placed lower in the decision process as this allows an ISP to override these suggestions,  by setting LocalPref."
64,Using a strict ordering of attributes in the decision process simplifies policy expression and makes it easier to predict the outcome of making configuration changes.
65,"While some vendors allow operators to disable certain steps in the decision process, they typically do not permit the operators to put the steps in a different order."
66,"Hence some policies that violate this ordering ( ignore AS path length, or first choose lowest MED then highest LocalPref) may require various hacks which can complicate router configuration and lead to unforeseen side effects."
67,"There are different locations where a route attribute can be set by policy: (a) Locally, for example LocalPref is an integer value set at and propagated throughout the local AS and filtered before sending to neighboring ISPs."
68,"(b) Neighbor, for example the MED attribute is typically used by two ASes connected by multiple links to indicate which peering link should be used to reach the AS advertising the MED attribute, and is not used to compare routes through two different next-hop ASes."
69,"(c) Neither: some attributes, for example whether the route was learned through an external BGP (eBGP) neighbor or from an internal router speaking BGP (iBGP), are set by the protocol and cannot be changed."
70,"The collective results of the decision process across routers is to produce a set of equally good border routers for each prefix, where each router in the set is equivalent according to the    first four steps of the decision process that compare BGP attributes."
71,Each internal router then chooses the router in that set that is closest according to the Interior Gateway Protocol (IGP) path cost to reach that border router.
72,"For example in Figure 1, suppose prefix 6.0.1.0/24 is reachable to B via both A and C, but B’s LocalPref is set higher for routes through A. The set of equally good border routers would then contain R1 and R2, and each router in B would select the route that was closest exit point (lowest IGP cost): ra and R1 would choose the route through R1, and all other routers would choose the route through R2."
73,There are three steps a router uses to process route advertisements.
74,"First import policy is applied to determine which routes should be filtered and hence eliminated from consideration, and may append or modify attributes."
75,"Next, the router applies the decision process to select the most desirable route."
76,"Finally, an export policy is applied which determines which neighbors the chosen route will be exported to."
77,"An ISP may implement its policy by controlling any of these three steps, i.e., by modifying import policy to filter routes it doesn’t want to use, modifying route attributes to prefer some routes over others, or by modifying export policy to avoid providing routes for certain neighbors to use."
78,"In addition, an ISP can modify attributes of routes it advertises, which can influence how its neighbors perform route selection."
79,2.3 Configuring local policies.
80,There are three classes of “knobs” that can be used to control import and export policies:  1.
81,Preference influences which BGP route will be chosen for each destination prefix.
82,Changing preference is done by adding/deleting/modifying route attributes in BGP advertisements.
83,"Table 1 shows which attributes can be modified during import to control preference locally, and which can be modified during export to change how much a neighbor prefers the route."
84,2.
85,Filtering eliminates certain routes from consideration and also controls who they will be exported to.
86,Filtering may be applied both before preference (inbound filtering) or after preference (outbound filtering).
87,Filtering is done by instructing routers to ignore advertisements with attributes matching certain specified values or ranges.
88,3.
89,"Tagging allows an operator to associate additional state with a route, which can be used to coordinate decisions made by a group of routers in an AS, or to share context across AS boundaries."
90,"The key mechanism is the community attribute, a variable-length string used to tag routes."
91,"The community attribute is a highly expressive mechanism, lending itself to support a wide variety of complex policies that are difficult to express through other means."
92,"For example, one community value might affect how the receiving router sets LocalPref, while another might cause the route to be filtered at another router."
93,"However, its expressiveness gives potential for misconfiguration, which is exacerbated by the fact that community attributes usage is not standardized."
94,An ISP implements its policies by applying configuration commands at routers.
95,"These configurations typically consist of a set of lists of preference, filtering, and tagging rules, one list for each session the router has with a neighboring BGP-speaking router."
96,"Although the configuration language differs between vendors, a key primitive that is often provided is a route-map, a language construct used to modify route attributes and define conditions that determine which routes are exported to peers."
97,"It consists of two parts: a set of conditions indicating when the map is to be invoked ( the prefix is a specified value, or the AS path matches a specified regular expression), and the action to be taken if the advertisement matches the conditions ( modify a specified attribute, or filter the route)."
98,3 Business relationships.
99,ISPs often wish to control next hop selection so as to reflect agreements or relationships they have with their neighbors.
100,"Three common relationships ISPs have are: customer-provider, where one ISP pays another to forward its traffic, peer-peer, where two ISPs agree that connecting directly to each other (typically without exchanging payment) would mutually benefit both, perhaps because roughly equal amounts of traffic flow between their networks, and backup relationships, where two ISPs set up a link between them that is to be used only in the event that the primary routes become unavailable due to failure."
101,There are two key ways these relationships manifest themselves in policy:  Influencing the decision process (by assigning LocalPrefs): ISPs often prefer customer-learned routes over routes learned from peers and providers when both are available.
102,This is often done because sending traffic through customers generates revenue for the ISP while sending traffic through providers costs the ISP money and sending to peers can skew the balance of power in the peering relationship and thereby give incentive to the party receiving more traffic to tear down the relationship or start charging the other party.
103,"Often an ISP will achieve this by assigning a non-overlapping range of LocalPref values to each type of peering relationship; for example LocalPref values in the range 90-99 might be used for customers, 80-89 for peers, 70-79 for providers, and 60-69 for backup links."
104,"LocalPref can then be varied within each range to do traffic engineering without violating the constraints associated with the business relationship, as described in Section 4."
105,"As another example, a large ISP spanning both North America and Europe may wish to avoid forwarding traffic generated by its customers across an expensive transatlantic link."
106,"This can be done by configuring its European routers with a higher LocalPref for routes learned from European ISPs, and giving its North American routers a lower LocalPref for these routes."
107,"Controlling route export (by using the community attribute): Routes learned from providers or peers are usually not exported to other providers or peers, because there is no economic incentive for an ISP to forward traffic it receives from one provider or peer to another."
108,"This can be done by tagging advertisements with a community attribute signifying the business relationship of the session, and filtering routes with certain community attributes when exporting routes to peers."
109,"For example, suppose B wishes to not export routes learned from A    to C (Figure 1), perhaps because it does not get paid for transitting traffic from C to A. It can do this as follows."
110,"First, for every session routers R1 and R2 have with routers in A, B configures an import policy that appends the community attribute Xpeer to any route learned over these sessions, to indicate that the route was received from a peer—information which is ordinarily lost in BGP as the route propagates across the AS."
111,"After appending the community attribute, B exports the route onwards into its internal iBGP network."
112,"Second, B configures export policies at R4 that match on this community attribute to determine which routes get exported to C. In particular, every session between R4 and a router in C is configured with an export policy that filters any route with the community attribute Xpeer ."
113,4 Traffic engineering.
114,"While business relationships affect relative preferences for routes, there are often several routes available that are equally preferred."
115,"Moreover, ISPs often connect at multiple locations to reduce delay and improve reliability, increasing the number of available routes."
116,A secondary goal for many ISPs is to engineer their traffic by modifying preference within the same business class to meet or maximize certain performance criteria ( achieve desired quality and availability).
117,"An ISP can do this by modifying the import policies applied by its routers, each of which can have a different configuration."
118,"In this section we describe several common traffic engineering goals (a related topic, ensuring the selected routes are stable, is discussed in [4])."
119,"Outbound traffic control (by changing LocalPref and IGP costs): Operators can influence outbound traffic flow either by configuring import policies that affect which routes get in the set of equally-good border routers, or by modifying IGP link costs."
120,"One common goal is early-exit routing (also called hotpotato routing), where the ISP forwards traffic to its closest possible exit point, so as to reduce the number of links packets traverse and hence the resulting congestion in its internal network."
121,"Although early-exit routing is known to inflate end-to-end path lengths in the Internet, ISPs often exercise early-exit routing to reduce their costs and network congestion, and because BGP does not support alternatives like determining global shortest paths across multiple ISPs."
122,Another common goal is to reduce congestion on outbound links to neighbors.
123,This can be done by load balancing traffic over several links when possible.
124,Outbound traffic engineering can be done by changing LocalPref.
125,"For example, suppose B wishes to shift some traffic from its links to A to its link to C as shown in Figure 1, perhaps because the link to A is overutilized or because it is planning to take the link down for maintenance."
126,B can reduce the traffic it sends to A and increase traffic it sends to C by decreasing LocalPref for routes traversing A or increasing LocalPref for routes traversing C.  Achieving a specific level of load balance ( balancing load to make spare capacity on both links equal) can be very difficult.
127,"The key challenge is to select the proper set of prefixes and change attributes for each appropriately; selecting too large a set will cause too much traffic to shift, overloading one of the links."
128,It can also be tedious to express a long list of prefixes in a router configuration file.
129,"Some ISPs deal with this by changing preference for all prefixes whose AS path matches a regu lar expression, then tweaking the regular expression repeatedly to control how many prefixes match it."
130,"However, since this is done manually it is subject to misconfiguration, cannot be done in real time to adjust to changing load, and the outcome from a change can be difficult to predict."
131,There are automated tools that an ISP can use to predict the effects of these actions [5].
132,"Inbound traffic control (by AS prepending and MED): An ISP’s internal congestion may be exacerbated by its neighbors, because its neighbors might not be aware of the ISP’s trafficengineering goals, internal topology, or load on internal links due to privacy reasons."
133,"Hence, some mechanism to allow an ISP to control how much traffic it receives from each of its peering links is essential."
134,"Unfortunately, this is a highly challenging problem, as it requires the local ISP to influence route selection in remote ISPs, which in turn might wish to limit or completely ignore the local ISP’s goals."
135,"However, an ISP may convince its neighbor (perhaps through economic incentives) to allow the ISP to control how much traffic it receives on each link from the neighbor."
136,"This can be done by modifying the MED attribute, which can be used between a pair of ISPs connected via multiple peering links."
137,"For example, if B wanted to reduce the amount of traffic traversing router R1, it could increase the value of the MED attribute R1 advertises to A, causing the link to R2 to become more preferred by A’s routers and thereby decreasing R1’s load."
138,"Shifting traffic between links to different neighbors is more challenging, as unfortunately BGP was not designed with a mechanism to control route selection in ASes multiple hops away."
139,"However, a workaround commonly used is for an AS to prepend multiple copies of its AS number to the AS path in order to artificially inflate the AS-path length."
140,"For example, suppose B wishes to shift some traffic from its link to A to its link to C. B can do this by prepending additional copies of its AS number onto the AS paths in BGP advertisements it sends to A. This increases the AS-path length in these advertisements, which causes routes advertised by C to other ISPs to become more desirable in comparison."
141,"Remote control (by changing community attributes): In certain cases, an ISP may need to remotely manage a router’s configuration to implement a desired policy."
142,"For example in Figure 1, suppose B wishes to have all inbound traffic routed through A, and suppose C peers with A (not shown in the figure)."
143,"If C has a LocalPref to prefer the direct route to B, no change in MED or AS prepending will force C to use alternate routes through A to B. B could request C to manually change its router configurations, but this can be time consuming for human operators if B changes its policy often ( for traffic engineering purposes)."
144,"Instead, C can allow B to control C’s routing policy with respect to B’s routes by configuring its routers to map certain community attributes to certain LocalPref values [2]."
145,"If desired, C can limit the degree of B’s control to prevent certain policies of its own from being subverted."
146,"For example, C can configure its routers to map community value X1 to a LocalPref of 60, and X2 to a LocalPref of 75, allowing B to disable the route, but not allowing B to have it chosen over routes C wants to prefer more (by setting a higher LocalPref, like 85)."
147,Remote control has some overlapping functionality with other    mechanisms to control inbound and outbound traffic.
148,"In general, remote control is typically used to allow a customer to tell its provider to perform some action on its behalf."
149,"Remote control provides more flexibility than MED because it allows control of inputs to earlier steps of the decision process like LocalPref, as shown in the example above."
150,"Moreover, MED can only change the relative preference of routes, while remote control can be configured to filter routes, or perform AS prepending."
151,"Further, MED is only used for routes with the same next-hop AS, while LocalPref is compared across routes learned from all neighbors."
152,"However, as with MED, an ISP’s neighbors must agree in advance to accept community attributes from the other peer."
153,"Also, the highly expressive nature of community attributes introduces potential for misconfiguration."
154,"For example, two adjacent ISPs may use the same community attribute to mean very different things ( one might use it for accounting purposes to indicate a certain customer generated the route, while another might use it to indicate the route should be filtered)."
155,"If a misconfigured router allows the attribute to be passed between them without being removed, unintended consequences could ensue."
156,"ISPs typically address this by careful router configuration, and by publishing the list of communities and what actions they trigger for their customers."
157,"In addition, there are a variety of “smart routing” tools [6] that small ASes at the edge of the Internet can use to balance outbound traffic over multiple upstream providers."
158,"However, these tools generally are not appropriate for ISPs, as dynamically changing traffic can lead to BGP routing changes that are visible to other ASes, which can trigger flap damping (a mechanism that withdraws unstable routes) if the routes become too unstable."
159,"Moreover, these tools focus on load balancing over multiple outgoing links but do not consider the effect on traffic flow inside the AS [5]."
160,5 Scalability.
161,Some misconfigurations and faults in neighboring ISPs can lead them to generate excessive rates of updates.
162,"Sending updates too frequently can trigger route instability, leading to poor service quality, or can overload a router’s processing capability or memory capacity, which can cause outages and router failure."
163,A properly configured set of BGP policies can improve the resilience of a network to these problems.
164,Common goals include:  Limiting routing table size (by filtering and using the community attribute): ISPs often want to limit routing table size because overflow can cause the router to crash [7].
165,This can be a particularly important issue for smaller ISPs which may have less expensive routers with less memory capacity.
166,1.
167,Protection from other ISPs: ISPs can protect themselves from excessive advertisements from neighbors by: (a) Filtering long prefixes ( longer than /24) to encourage use of aggregation [8].
168,"(b) As a safety check, routers often maintain a fixed per-session prefix limit that limits the number of prefixes a neighbor can advertise."
169,"(c) Default routing: an ISP with a small number of routes may not need the entire routing table, and may instead configure a default route through which most destinations can be reached."
170,2.
171,"Protecting other ISPs: An ISP can reduce the number of prefixes it advertises by using route aggregation, where instead of advertising two adjacent prefixes ( 4.1.2.0/24 and 4.1.3.0/24) to a neighbor, they can be filtered in the export policy and a less specific prefix ( 4.1.2.0/23) advertised [9]."
172,"However, doing this effectively may require knowledge of the neighbor’s connectivity (which is not discovered or signaled by the BGP protocol and hence must be manually detected and accounted for by human operators) as illustrated in the following example."
173,Suppose E (Figure 2) owns prefix 6.0.0.0/8.
174,"E has allocated the subnet 6.1.0.0/16 to router R5, and has allocated smaller subnets to its customers connected to R5, including a new customer D which is allocated subnet 6.1.1.0/24."
175,"When adding D as a new customer, E may need to make changes to its routers’ configuration, and the configuration it chooses impacts whether new advertisements are generated."
176,There are three cases:  1.
177,"No new advertisements: Suppose D’s sole provider is E, and D connects to just one router R5 in E. In this case, R5 is already advertising 6.1.0.0/16 within AS E, obviating the need for R5 to advertise more specific subnets like 6.1.1.0/24."
178,"Hence, E just adds a statically configured route at R5 to forward all traffic in 6.1.1.0/24 to D, and so no advertisements will be sent from E to its neighbors, nor will any new advertisements be sent internally within E."
179,2.
180,"Internal advertisement: Suppose instead D connects to two routers R5 and R6 in E. In this case, both R5 and R6 need to advertise the prefix 6.1.1.0/24 within E, so all routers within E know they can reach D via either R5 or R6."
181,"However, E can aggregate the advertisement into its address space and hence E will not send BGP advertisements for 6.1.0.0/24 to its neighbors."
182,"This is done by configuring R5 and R6 to tag a community attribute onto advertisements of prefix 6.1.1.0/24, and configuring all border routers to filter routes with that community attribute."
183,3.
184,"External and internal advertisement: Suppose D connects to both E and F. In this case E should not aggregate the prefix into its own address space; if it did, then F would then be advertising a longer prefix route to reach D, and since routers forward packets based on the longest prefix match, all routers in the Internet will prefer F’s route    over E’s route."
185,"If D wishes traffic to flow over both links, it must request that E not perform aggregation on its prefix."
186,"E can avoid aggregating the prefix by configuring its routers peering with D to append a certain community attribute, and configure its border routers to export routes containing that community attribute."
187,"Limit the number of routing changes (by suppressing routes that flap): Routing instability is undesirable, as it can increase CPU load on routers, which can increase reaction time to important events."
188,"Also, frequent shifting of traffic to different paths can introduce jitter and packet loss in applications like Voice-over-IP and interfere with TCP’s round-trip-time calculations."
189,The key mechanism used to improve routing stability is flap damping.
190,Flap damping is a mechanism that limits propagation of unstable routes.
191,It works by maintaining a penalty value associated with the route that is incremented whenever an update is received.
192,"When the penalty value surpasses a configurable threshold, the route is suppressed for some time, i.e., it is made unavailable to the decision process and hence will not be selected."
193,An ISP can lower the penalty threshold to improve route stability at the cost of worsening availability.
194,"ISPs may wish to less aggressively dampen or disable damping for certain prefixes, for example routes to the root Domain Name System servers, or routes from customers with high availability requirements."
195,"Also, ISPs sometimes more aggressively dampen longer prefixes than shorter prefixes, with the motivation that damping a shorter prefix can have a large effect on reachability [10]."
196,This can be done by configuring a route-map that matches on the prefix length or a specific prefix and sets the flap damping parameters accordingly.
197,6 Security.
198,An AS is highly vulnerable to false information in BGP updates.
199,"By sending false information, an ISP can subvert a neighbor’s routing goals, cause routers to overload and fail, or degrade service quality."
200,"False information can have a significant influence on routing in an AS, even if the source of the information is several AS hops away [11]."
201,Such information is sometimes generated by router bugs and misconfiguration.
202,"It could also be maliciously generated by an ISP’s neighbor, who may be competing for customers and hence has a vested interest in making the ISP’s customers dissatisfied with service."
203,Hence an ISP may wish to exercise defensive programming to protect itself against attacks.
204,Discarding invalid routes (by import filtering): ISPs may wish to protect their customers from learning invalid routes by performing sanity checks to ensure update contents are valid before propagating them internally.
205,"For example, routes to special-use or private addresses, or address blocks that have not yet been allocated are obviously invalid [12]."
206,"Moreover, advertisements from customers for prefixes they do not own should not be propagated."
207,ISPs can also perform certain sanity checks on the AS path; for example a Tier-1 ISP should not accept any routes from its customers that contain another Tier-1 ISP in the AS path.
208,"Also, advertisements containing private AS numbers in the AS path may be considered invalid."
209,"ISPs may configure its filters based on the contents of public repositories  of routing configurations called routing registries, other public reports [13], or private disclosures from neighbors."
210,"Protect integrity of routing policies (by rewriting attributes): An ISP may want to prevent a neighboring AS from having undue influence over its routing decisions, in violation of their peering agreement."
211,"Otherwise, the ISP could be duped into carrying traffic a longer distance across its backbone on the neighbor’s behalf."
212,"For example, suppose the ISP peers with a neighbor in both New York and San Francisco."
213,"By advertising a prefix with a MED of 0 in New York and a MED of 1 in San Francisco, the peer could trick the ISP into having all of its routers direct traffic for this destination through the New York peering point, even if the San Francisco peering point is closer."
214,The peer could achieve the same goal by configuring its San Francisco router to advertise the route with the nexthop attribute wrongly set to the IP address of the New York router.
215,"To defend against violations of peering agreements, the ISP can configure the import policy to delete attributes or overwrite them with the expected values."
216,"For example, the import policy could set all MED values to 0, unless the ISP has agreed in advance to honor the neighbor’s MEDs."
217,"Similarly, the import policy could set the next-hop attribute to the IP address of the remote end of the BGP session, and remove any unexpected community values."
218,"Unfortunately, these techniques are not sufficient to prevent all violations of peering agreements1."
219,Securing the network infrastructure (by export filtering): An ISP may wish to prevent external entities from accessing certain internal resources by configuring its export policies that filter BGP advertisements for destinations that should not be externally reachable.
220,"For example, the ISP may protect its own backbone infrastructure by filtering the IP addresses used to number the router interfaces."
221,"The ISP may also wish to protect certain key internal services, by filtering the addresses of the hosts running network-management software."
222,"Finally, as a courtesy to its neighbors, an ISP may also do export filtering of invalid routes ( routes with invalid addresses or contents), as a preventative measure."
223,Blocking denial-of-service attacks (by filtering and damping): Denial-of-service attacks can degrade service by overloading the routers with extra BGP update messages or consuming excessive amounts of link bandwidth.
224,"For example, the ISP’s routers could run out of memory if a neighbor sends route advertisements for a large number of destination prefixes."
225,"To protect itself, the ISP can configure each BGP session with a maximum acceptable number of prefixes, tearing down the session when the limit is exceeded; in addition, the import policy could filter prefixes with large mask lengths ( longer than /24)."
226,"As another example, a neighbor sending an excessive number of BGP update messages can easily deplete the CPU resources on the ISP’s routers."
227,"Upon detecting the excessive BGP updates, the operators could modify the import policy to discard advertisements for the offending prefixes or disable the BGP session."
228,"Upon identifying the neighbor or prefix responsible for the excessive BGP updates, the ISP can more aggressively dampen (Section 5) or even completely filter updates it receives from these sources."
229,"In addition to BGP’s own vulnerabilities to attack, an ISP (or its customers) may be subject to a denial-of-service attack where excessive data traffic is sent to victim hosts."
230,An ISP can block the offending traffic by installing a blackhole route that drops traffic destined to the victim addresses.
231,"Blackhole routes may be statically configured, or operators may run a special BGP session that advertises the prefixes of the victims [17]."
232,"Routers receiving prefixes on this session then assign the next-hop to be an address associated with the “null” route (a route which drops all traffic), or the address of a monitoring system that can perform further analysis of the traffic."
233,"Using a similar technique, the ISP can advertise the address blocks of known spammers to blackhole traffic sent to these addresses."
234,"These blackhole routes prevent the spammers from establishing bidirectional communication (i.e., a TCP connection, which depends on receiving a SYNACK packet) with the ISP’s mail servers."
235,7 Looking forward.
236,"BGP’s rich feature set of tunable knobs and complex cross-protocol interactions make it highly subject to a variety of problems, including misconfiguration, oscillations, and protocol divergence."
237,The challenge of supporting many different complex policies in BGP without significantly complicating the protocol or degrading its performance has led to much research activity.
238,Three key areas of research related to BGP policy are discussed below (a wider survey of research directions is given in [18]).
239,"Configuration checking: The complexity of Internet routing makes it difficult to predict the way policies interact, increasing the prevalence of configuration mistakes."
240,Interdependence of policy across ISPs and within a single ISP can trigger problems like persistent route oscillations.
241,"Configuration checking tools can avoid misconfigurations by verifying certain consistency criteria hold [19], and modeling tools can predict side-effects of configuration changes on routers within an ISP [5]."
242,"Across ISPs, uncoordinated routing policy can worsen route convergence and stability."
243,"The Routing Arbiter [13] project introduced a distributed architecture for publishing and coordinating routing policies so as to avoid these problems, but was not widely deployed."
244,Other work has attempted to coordinate route policy selection across ISPs without revealing private details of policies [20].
245,Language design: Routing Policy Specification Language (RPSL) [21] is a vendor-neutral language proposed to describe an ISP’s policy.
246,It was envisioned these descriptions could be bound together in a database and checked for consistency [13].
247,"RPSL, though mature, is somewhat low-level and mechanism oriented."
248,"It may be possible to substantially improve upon RPSL by designing router configuration languages with higher level constructs that allow diverse policies while precluding certain misconfigurations, enforcing certain consistency properties to hold, simplifying configuration of certain common design patterns [22], however the design of such a language remains an open problem."
249,New architectures: There are several routing architectures aimed at fixing problems in and extending functionality of BGP.
250,HLP [23] is a proposed replacement for eBGP.
251,"The design philosophy of HLP is to expose common policies that can typically be inferred in BGP today and optimize the routing protocol based on the resulting structure, with the aim to improve scalability and convergence of interdomain routes."
252,Routing Control Platform (RCP) [24] is a logically centralized system that computes and distributes routes to routers inside an ISP.
253,"The centralization allows policies to be applied at the AS level, and the RCP applies the policies and its own decision process to select the best BGP route for each destination prefix on behalf of each router."
254,This simplifies the configuration and application of policies and avoids misconfiguration.
255,8 Conclusion.
256,"Although BGP policies can be highly complex, there are a number of common design patterns that are typically used by ISPs."
257,In this article we discussed several common patterns and how they can be realized using BGP policy mechanisms.
258,"We believe that by recognizing these patterns exist we can more efficiently develop tools that directly support them, such as analysis tools that check correctness, languages that preclude errors, or architectures that are designed for common cases."
259,Border Gateway Protocol (BGP) is a standardized exterior gateway protocol designed to exchange routing and reachability information among autonomous systems (AS) on the Internet.
260,"[1] BGP is classified as a path- vector routing protocol,[2] and it makes routing decisions based on paths, network policies, or rule-sets configured by a network administrator."
261,"BGP used for routing within an autonomous system is called Interior Border Gateway Protocol, Internal BGP (iBGP)."
262,"In contrast, the Internet application of the protocol is called Exterior Border Gateway Protocol, External BGP (eBGP)."
263,"The Border Gateway Protocol was first described in 1989 in RFC 1105, and has been in use on the Internet since 1994."
264,"[3] IPv6 BGP was first defined in RFC 1883 in 1995, and it was improved to RFC 2283 in 1998."
265,"The current version of BGP is version 4 (BGP4), which was published as RFC 4271 in 2006."
266,"[4] RFC 4271 corrected errors, clarified ambiguities and updated the specification with common industry practices."
267,The major enhancement was the support for Classless Inter-Domain Routing (CIDR) and use of route aggregation to decrease the size of routing tables.
268,"The new RFC allows BGP4 to carry a wide range of IPv4 and IPv6 ""address families""."
269,It is also called the Multiprotocol Extensions which is Multiprotocol BGP (MP-BGP).
270,"BGP neighbors, called peers, are established by manual configuration among routers to create a TCP session on port 179."
271,A BGP speaker sends 19-byte keep-alive messages every 60 seconds[5] to maintain the connection.
272,"[6] Among routing protocols, BGP is unique in using TCP as its transport protocol."
273,"When BGP runs between two peers in the same autonomous system (AS), it is referred to as Internal BGP (i- BGP or Interior Border Gateway Protocol)."
274,"When it runs between different autonomous systems, it is called External BGP (eBGP or Exterior Border Gateway Protocol)."
275,"Routers on the boundary of one AS exchanging information with another AS are called border or edge routers or simply eBGP peers and are typically connected directly, while i-BGP peers can be interconnected through other intermediate routers."
276,"Other deployment topologies are also possible, such as running eBGP peering inside a VPN tunnel, allowing two remote sites to exchange routing information in a secure and isolated manner."
277,The main difference between iBGP and eBGP peering is in the way routes that were received from one peer are propagated to other peers.
278,"For instance, new routes learned from an eBGP peer are typically redistributed to all iBGP peers as well as all other eBGP peers (if transit mode is enabled on the router)."
279,"However, if new routes are learned on an iBGP peering, then they are re-advertised only to all eBGP peers."
280,These route- propagation rules effectively require that all iBGP peers inside an AS are interconnected in a full mesh.
281,How routes are propagated can be controlled in detail via the route-maps mechanism.
282,This mechanism consists of a set of rules.
283,"Each rule describes, for routes matching some given criteria, what action should be taken."
284,"The action could be to drop the route, or it could be to modify some attributes of the route before inserting it in the routing table."
285,"During the peering handshake, when OPEN messages are exchanged, BGP speakers can negotiate optional capabilities of the session,[7] including multiprotocol extensions[8] and various recovery modes."
286,"If the multiprotocol extensions to BGP are negotiated at the time of creation, the BGP speaker can prefix the Network Layer Reachability Information (NLRI) it advertises with an address family prefix."
287,"These families include the IPv4 (default), IPv6, IPv4/IPv6 Virtual Private Networks and multicast BGP."
288,"Increasingly, BGP is used as a generalized signaling protocol to carry information about routes that may not be part of the global Internet, such as VPNs."
289,"[9]  In order to make decisions in its operations with peers, a BGP peer uses a simple finite state machine (FSM) that consists of six states: Idle; Connect; Active; OpenSent; OpenConfirm; and Established."
290,"For each peer-to- peer session, a BGP implementation maintains a state variable that tracks which of these six states the session is in."
291,The BGP defines the messages that each peer should exchange in order to change the session from one state to another.
292,The first state is the Idle state.
293,"In the Idle state, BGP initializes all resources, refuses all inbound BGP connection attempts and initiates a TCP connection to the peer."
294,The second state is Connect.
295,"In the Connect state, the router waits for the TCP connection to complete and transitions to the OpenSent state if successful."
296,"If unsuccessful, it starts the ConnectRetry timer and transitions to the Active state upon expiration."
297,"In the Active state, the router resets the ConnectRetry timer to zero and returns to the Connect state."
298,"In the OpenSent state, the router sends an Open message and waits for one in return in order to transition to the OpenConfirm state."
299,"Keepalive messages are exchanged and, upon successful receipt, the router is placed into the Established state."
300,"In the Established state, the router can send and receive: Keepalive; Update; and Notification messages to and from its peer."
301,"In the simplest arrangement, all routers within a single AS and participating in BGP routing must be configured in a full mesh: each router must be configured as a peer to every other router."
302,"This causes scaling problems, since the number of required connections grows quadratically with the number of routers involved."
303,"To alleviate the problem, BGP implements two options: route reflectors (RFC 4456) and BGP confederations (RFC 5065)."
304,The following discussion of basic UPDATE processing assumes a full iBGP mesh.
305,"A given BGP router may accept Network Layer Reachability Information (NLRI) UPDATEs from multiple neighbors and advertise NLRI to the same, or a different set, of neighbors."
306,"Conceptually, BGP maintains its own master routing table, called the local routing information base (Loc-RIB), separate from the main routing table of the router."
307,"For each neighbor, the BGP process maintains a conceptual adjacent routing information base, incoming (Adj-RIB-In) containing the NLRI received from the neighbor, and a conceptual outgoing information base (Adj-RIB-Out) for NLRI to be sent to the neighbor."
308,The physical storage and structure of these conceptual tables are decided by the implementer of the BGP code.
309,"Their structure is not visible to other BGP routers, although they usually can be interrogated with management commands on the local router."
310,"It is quite common, for example, to store the two Adj-RIBs and the Loc-RIB together in the same data structure, with additional information attached to the RIB entries."
311,"The additional information tells the BGP process such things as whether individual entries belong in the Adj-RIBs for specific neighbors, whether the peer-neighbor route selection process made received policies eligible for the Loc-RIB, and whether Loc-RIB entries are eligible to be submitted to the local router's routing table management process."
312,BGP will submit the routes that it considers best to the main routing table process.
313,"Depending on the implementation of that process, the BGP route is not necessarily selected."
314,"For example, a directly connected prefix, learned from the router's own hardware, is usually most preferred."
315,"As long as that directly connected route's interface is active, the BGP route to the destination will not be put into the routing table."
316,"Once the interface goes down, and there are no more preferred routes, the Loc-RIB route would be installed in the main routing table."
317,"Until recently, it was a common mistake to say, ""BGP carries policies."""
318,BGP actually carried the information with which rules inside BGP-speaking routers could make policy decisions.
319,Some of the information carried that is explicitly intended to be used in policy decisions are communities and multi-exit discriminators (MED).
320,"The BGP standard specifies a number of decision factors, more than the ones that are used by any other common routing process, for selecting NLRI to go into the Loc-RIB."
321,The first decision point for evaluating NLRI is that its next-hop attribute must be reachable (or resolvable).
322,"Another way of saying the next-hop must be reachable is that there must be an active route, already in the main routing table of the router, to the prefix in which the next-hop address is reachable."
323,"Next, for each neighbor, the BGP process applies various standard and implementation-dependent criteria to decide which routes conceptually should go into the Adj-RIB-In."
324,"The neighbor could send several possible routes to a destination, but the first level of preference is at the neighbor level."
325,Only one route to each destination will be installed in the conceptual Adj-RIB-In.
326,"This process will also delete, from the Adj-RIB-In, any routes that are withdrawn by the neighbor."
327,"Whenever a conceptual Adj-RIB-In changes, the main BGP process decides if any of the neighbor's new routes are preferred to routes already in the Loc-RIB."
328,"If so, it replaces them."
329,"If a given route is withdrawn by a neighbor, and there is no other route to that destination, the route is removed from the Loc-RIB and no longer sent by BGP to the main routing table manager."
330,"If the router does not have a route to that destination from any non-BGP source, the withdrawn route will be removed from the main routing table."
331,"After verifying that the next hop is reachable, if the route comes from an internal (i.e. iBGP) peer, the first rule to apply, according to the standard, is to examine the LOCAL_PREFERENCE attribute."
332,"If there are several iBGP routes from the neighbor, the one with the highest LOCAL_PREFERENCE is selected unless there are several routes with the same LOCAL_PREFERENCE."
333,In the latter case the route selection process moves to the next tiebreaker.
334,"While LOCAL_PREFERENCE is the first rule in the standard, once reachability of the NEXT_HOP is verified, Cisco and several other vendors first consider a decision factor called WEIGHT which is local to the router (i.e. not transmitted by BGP)."
335,The route with the highest WEIGHT is preferred.
336,"The LOCAL_PREFERENCE, WEIGHT, and other criteria can be manipulated by local configuration and software capabilities."
337,"Such manipulation, although commonly used, is outside the scope of the standard."
338,"For example, the COMMUNITY attribute (see below) is not directly used by the BGP selection process."
339,The BGP neighbor process however can have a rule to set LOCAL_PREFERENCE or another factor based on a manually programmed rule to set the attribute if the COMMUNITY value matches some pattern matching criterion.
340,If the route was learned from an external peer the per-neighbor BGP process computes a LOCAL_PREFERENCE value from local policy rules and then compares the LOCAL_PREFERENCE of all routes from the neighbor.
341,At the per-neighbor level – ignoring implementation-specific policy modifiers – the order of tie-breaking rules is:  1.
342,Prefer the route with the shortest AS_PATH.
343,An AS_PATH is the set of AS numbers that must be traversed to reach the advertised destination.
344,AS1-AS2-AS3 is shorter than AS4-AS5-AS6- AS7.
345,2.
346,Prefer routes with the lowest value of their ORIGIN attribute.
347,3.
348,Prefer routes with the lowest MULTI_EXIT_DISC (multi-exit discriminator or MED) value.
349,"[a]  Once candidate routes are received from neighbors, the Loc-RIB software applies additional tie-breakers to routes to the same destination."
350,1.
351,"If at least one route was learned from an external neighbor (i.e., the route was learned from eBGP), drop all routes learned from iBGP."
352,2.
353,"Prefer the route with the lowest interior cost to the NEXT_HOP, according to the main routing table."
354,"If two neighbors advertised the same route, but one neighbor is reachable via a low- bitrate link and the other by a high-bitrate link, and the interior routing protocol calculates lowest cost based on highest bitrate, the route through the high-bitrate link would be preferred and other routes dropped."
355,"If there is more than one route still tied at this point, several BGP implementations offer a configurable option to load-share among the routes, accepting all (or all up to some number)."
356,3.
357,Prefer the route learned from the BGP speaker with the numerically lowest BGP identifier  4.
358,Prefer the route learned from the BGP speaker with the lowest peer IP address  BGP communities are attribute tags that can be applied to incoming or outgoing prefixes to achieve some common goal (RFC 1997).
359,"While it is common to say that BGP allows an administrator to set policies on how prefixes are handled by ISPs, this is generally not possible, strictly speaking."
360,"For instance, BGP natively has no concept to allow one AS to tell another AS to restrict advertisement of a prefix to only North American peering customers."
361,"Instead, an ISP generally publishes a list of well-known or proprietary communities with a description for each one, which essentially becomes an agreement of how prefixes are to be treated."
362,"RFC 1997 also defines three well-known communities that have global significance; NO_EXPORT, NO_ADVERTISE and NO_EXPORT_SUBCONFED."
363,RFC 7611 defines ACCEPT_OWN.
364,"Examples of common communities include local preference adjustments, geographic or peer type restrictions, DoS avoidance (black holing), and AS prepending options."
365,An ISP might state that any routes received from customers with community XXX:500 will be advertised to all peers (default) while community XXX:501 will restrict advertisement to North America.
366,"The customer simply adjusts their configuration to include the correct community or communities for each route, and the ISP is responsible for controlling who the prefix is advertised to."
367,"The end user has no technical ability to enforce correct actions being taken by the ISP, though problems in this area are generally rare and accidental."
368,"It is a common tactic for end customers to use BGP communities (usually ASN:70,80,90,100) to control the local preference the ISP assigns to advertised routes instead of using MED (the effect is similar)."
369,"The community attribute is transitive, but communities applied by the customer very rarely become propagated outside the next-hop AS."
370,"Not all ISPs give out their communities to the public, while some others do."
371,"[10]  The BGP Extended Community Attribute was added in 2006, in order to extend the range of such attributes and to provide a community attribute structuring by means of a type field."
372,The extended format consists of one or two octets for the type field followed by seven or six octets for the respective community attribute content.
373,The definition of this Extended Community Attribute is documented in RFC 4360.
374,The IANA administers the registry for BGP Extended Communities Types.
375,[11] The Extended Communities Attribute itself is a transitive optional BGP attribute.
376,"However, a bit in the type field within the attribute decides whether the encoded  extended community is of a transitive or non-transitive nature."
377,The IANA registry therefore provides different number ranges for the attribute types.
378,"Due to the extended attribute range, its usage can be manifold."
379,"RFC 4360 exemplarily defines the ""Two-Octet AS Specific Extended Community"", the ""IPv4 Address Specific Extended Community"", the ""Opaque Extended Community"", the ""Route Target Community"", and the ""Route Origin Community""."
380,A number of BGP QoS drafts[12] also use this Extended Community Attribute structure for inter-domain QoS signalling.
381,"Note: since RFC 7153, extended communities are compatible with 32-bit ASNs."
382,"With the introduction of 32-bit AS numbers, some issues were immediately obvious with the community attribute that only defines a 16 bits ASN field, which prevents the matching between this field and the real ASN value."
383,"It is the reason why RFC 8092 and RFC 8195 introduce a Large Community (http://largebgpcom munities.net/) attribute of 12 bytes, divided in three field of 4 bytes each (AS:function:parameter)."
384,"MEDs, defined in the main BGP standard, were originally intended to show to another neighbor AS the advertising AS's preference as to which of several links are preferred for inbound traffic."
385,"Another application of MEDs is to advertise the value, typically based on delay, of multiple AS that have presence at an IXP, that they impose to send traffic to some destination."
386,"BGP is ""the most scalable of all routing protocols."
387,"""[13]  An autonomous system with internal BGP (iBGP) must have all of its iBGP peers connect to each other in a full mesh (where everyone speaks to everyone directly)."
388,This full-mesh configuration requires that each router maintain a session to every other router.
389,"In large networks, this number of sessions may degrade performance of routers, due to either a lack of memory, or high CPU process requirements."
390,Route reflectors[14] reduce the number of connections required in an AS.
391,A single router (or two for redundancy) can be made a route reflector: other routers in the AS need only be configured as peers to them.
392,A route reflector offers an alternative to the logical full-mesh requirement of internal border gateway protocol (IBGP).
393,A RR acts as a for IBGP sessions.
394,The purpose of the RR is concentration.
395,"Multiple BGP routers can peer with a central point, the RR – acting as a route reflector server – rather than peer with every other router in a full mesh."
396,All the other IBGP routers become route reflector clients.
397,"This approach, similar to OSPF's DR/BDR feature, provides large networks with added IBGP scalability."
398,"In a fully meshed IBGP network of 10 routers, 90 individual CLI statements (spread throughout all routers in the topology) are needed just to define the remote-AS of each peer: this quickly becomes a headache to manage."
399,"A RR topology could cut these 90 statements down to 18, offering a viable solution for the larger networks administered by ISPs."
400,"A route reflector is a single point of failure, therefore at least a second route reflector may be configured in order to provide redundancy."
401,"As it is an additional peer for the other 10 routers, it comes with the additional statement count to double that minus 2 of the single Route Reflector setup."
402,An additional 11*2-2=20 statements in this case due to adding the additional Router.
403,"Additionally, in a BGP multipath Environment this also can benefit by adding local switching/Routing throughput if the RRs are acting as traditional Routers instead of just a dedicated Route Reflector Server role."
404,"RR servers propagate routes inside the AS based on the following rules:  If a route is received from a non-client peer, reflect to clients only and EBGP peers."
405,"If a route is received from a client peer, reflect to all non-client peers and also to client peers, except the originator of the route and reflect to EBGP peers."
406,"RR and its clients form a ""Cluster""."
407,"The ""Cluster-ID"" is then attached to every route advertised by RR to its client or nonclient peers."
408,"Cluster-ID is a cumulative, non- transitive BGP attribute and every RR MUST prepend the local CLUSTER_ID to the CLUSTER_LIST in order to avoid routing loops."
409,Route reflectors and confederations both reduce the number of iBGP peers to each router and thus reduce processing overhead.
410,"Route reflectors are a pure performance-enhancing technique, while confederations also can be used to implement more fine-grained policy."
411,Confederations are sets of autonomous systems.
412,"In common practice,[15] only one of the confederation AS numbers is seen by the Internet as a whole."
413,Confederations are used in very large networks where a large AS can be configured to encompass smaller more manageable internal ASs.
414,The confederated AS is composed of multiple ASs.
415,Each confederated AS alone has iBGP fully meshed and has connections to other ASs inside the confederation.
416,"Even though these ASs have eBGP peers to ASs within the confederation, the ASs exchange routing as if they used iBGP."
417,"In this way, the confederation preserves next hop, metric, and local preference information."
418,"To the outside world, the confederation appears to be a single AS."
419,"With this solution, iBGP transit AS problems can be resolved as iBGP requires a full mesh between all BGP routers: large number of TCP sessions and unnecessary duplication of routing traffic."
420,Confederations can be used in conjunction with route reflectors.
421,"Both confederations and route reflectors can be subject to persistent oscillation unless specific design rules, affecting both BGP and the interior routing protocol, are followed."
422,"[16]  However, these alternatives can introduce problems of their own, including the following: route oscillation, sub-optimal routing, increase of BGP convergence time."
423,"Additionally, route reflectors and BGP confederations were not designed to ease BGP router configuration."
424,"Nevertheless, these are common tools for experienced BGP network architects."
425,"These tools may be combined, for example, as a hierarchy of route reflectors."
426,"The routing tables managed by a BGP implementation are adjusted continually to reflect actual changes in the network, such as links breaking and being restored or routers going down and coming back up."
427,"In the network as a whole it is normal for these changes to happen almost continuously, but for any particular router or link, changes are supposed to be relatively infrequent."
428,If a router is misconfigured or mismanaged then it may get into a rapid cycle between down and up states.
429,"This pattern of repeated withdrawal and re-announcement known as route flapping can cause excessive activity in all the other routers that know about the broken link, as the same route is continually injected and withdrawn from the routing tables."
430,The BGP design is such that delivery of traffic may not function while routes are being updated.
431,"On the Internet, a BGP routing change may cause outages for several minutes."
432,A feature known as route flap damping (RFC 2439 (http://www.ietf.org/rfc/rfc2439.txt)) is built into many BGP implementations in an attempt to mitigate the effects of route flapping.
433,"Without damping, the excessive activity can cause a heavy processing load on routers, which may in turn delay updates on other routes, and so affect overall routing stability."
434,"With damping, a route's flapping is exponentially decayed."
435,"At the first instance when a route becomes unavailable and quickly reappears, damping does not take effect, so as to maintain the normal fail-over times of BGP."
436,"At the second occurrence, BGP shuns that prefix for a certain length of time; subsequent occurrences are timed out exponentially."
437,"After the abnormalities have ceased and a suitable length of time has passed for the offending route, prefixes can be reinstated and its slate wiped clean."
438,Damping can also mitigate denial of service attacks; damping timings are highly customizable.
439,"It is also suggested in RFC 2439 (under ""Design Choices -> Stability Sensitive Suppression of Route Advertisement"") that route flap damping is a feature more desirable if implemented to Exterior Border Gateway Protocol Sessions (eBGP sessions or simply called exterior peers) and not on Interior Border Gateway Protocol Sessions (iBGP sessions or simply called internal peers); With this approach when a route flaps inside an autonomous system, it is not propagated to the external ASs – flapping a route to an eBGP will have a chain of flapping for the particular route throughout the backbone."
440,This method also successfully avoids the overhead of route flap damping for iBGP sessions.
441,"However, subsequent research has shown that flap damping can actually lengthen convergence times in some cases, and can cause interruptions in connectivity even when links are not flapping."
442,"[18][19] Moreover, as backbone links and router processors have become faster, some network architects have suggested that flap damping may not be as important as it used to be, since changes to the routing table can be handled much faster by routers."
443,"[20] This has led the RIPE Routing Working Group to write that ""with the current implementations of BGP flap damping, the application of flap damping in ISP networks is NOT recommended."
444,"... If flap damping is implemented, the ISP operating that network will cause side-effects to their customers and the Internet users of their customers' content and services ... ."
445,These side-effects would quite likely be worse than the impact caused by simply not running flap damping at all.
446,"""[21] Improving stability without the problems of flap damping is the subject of current research."
447,"[22]  One of the largest problems faced by BGP, and indeed the Internet infrastructure as a whole, is the growth of the Internet routing table."
448,"If the global routing table grows to the point where some older, less capable routers cannot cope with the memory requirements or the CPU load of maintaining the table, these routers will cease to be effective gateways between the parts of the Internet they connect."
449,"In addition, and perhaps even more importantly, larger routing tables take longer to stabilize (see above) after a major connectivity change, leaving network service unreliable, or even unavailable, in the interim."
450,"Until late 2001, the global routing table was growing exponentially, threatening an eventual widespread breakdown of connectivity."
451,"In an attempt to prevent this, ISPs cooperated in keeping the global routing table as small as possible, by using Classless Inter-Domain Routing (CIDR) and route aggregation."
452,"While this slowed the growth of the routing table to a linear process for several years, with the expanded demand for multihoming by end user networks the growth was once again superlinear by the middle of 2004."
453,A Y2K-like overflow triggered in 2014 for those models that were not appropriately updated.
454,"While a full IPv4 BGP table as of August 2014 (512k day)[23][24] was in excess of 512,000 prefixes,[25] many older routers had a limit of 512k (512,000–524,288)[26][27] routing table entries."
455,"On August 12, 2014, outages resulting from full tables hit eBay, LastPass and Microsoft Azure among others."
456,"[28] A number of Cisco routers commonly in use had TCAM, a form of high-speed content-addressable memory, for storing BGP advertised routes."
457,"On impacted routers, the TCAM was default allocated as 512k IPv4 routes and 256k IPv6 routes."
458,"While the reported number of IPv6 advertised routes was only about 20k, the number of advertised IPv4 routes reached the default limit, causing a spillover effect as routers attempted to compensate for the issue by using slow software routing (as opposed to fast hardware routing via TCAM)."
459,"The main method for dealing with this issue involves operators changing the TCAM allocation to allow more IPv4 entries, by reallocating some of the TCAM reserved for IPv6 routes, which requires a reboot on most routers."
460,The 512k problem was predicted by a number of IT professionals.
461,"The actual allocations which pushed the number of routes above 512k was the announcement of about 15,000 new routes in short order, starting at 07:48 UTC."
462,"Almost all of these routes were to Verizon Autonomous Systems 701 and 705, created as a result of deaggregation of larger blocks, introducing thousands of new /24 routes, and making the routing table reach 515,000 entries."
463,"The new routes appear to have been reaggregated within 5 minutes, but instability across the Internet apparently continued for a number of hours."
464,"[32] Even if Verizon had not caused the routing table to exceed 512k entries in the short spike, it would have happened soon anyway through natural growth."
465,"Route summarization is often used to improve aggregation of the BGP global routing table, thereby reducing the necessary table size in routers of an AS."
466,"Consider AS1 has been allocated the big address space of 172.16.0.0/16, this would be counted as one route in the table, but due to customer requirement or traffic engineering purposes, AS1 wants to announce smaller, more specific routes of 172.16.0.0 /18 , 172.16.64.0/18, and 172.16.128.0/18."
467,The prefix 172.16.192.0/18 does not have any hosts so AS1 does not announce a specific route 172.16.192.0/18.
468,This all counts as AS1 announcing four routes.
469,"AS2 will see the four routes from AS1 (172.16.0.0/16, 172.16.0.0/18, 172.16.64.0/18, and 172.16.128.0/18) and it is up to the routing policy of AS2 to decide whether or not to take a copy of the four routes or, as 172.16.0.0/16 overlaps all the other specific routes, to just store the summary, 172.16.0.0/16."
470,"If AS2 wants to send data to prefix 172.16.192.0/18, it will be sent to the routers of AS1 on route 172.16.0.0/16."
471,"At AS1's router, it will either be dropped or a destination unreachable ICMP message will be sent back, depending on the configuration of AS1's routers."
472,"If AS1 later decides to drop the route 172.16.0.0/16, leaving 172.16.0.0/18, 172.16.64.0/18, and 172.16.128.0/18, AS1 will drop the number of routes it announces to three."
473,"AS2 will see the three routes, and depending on the routing policy of AS2, it will store a copy of the three routes, or aggregate the prefix's 172.16.0.0/18 and 172.16.64.0/18 to 172.16.0.0/17, thereby reducing the number of routes AS2 stores to only two: 172.16.0.0/17 and 172.16.128.0/18."
474,"If AS2 wants to send data to prefix 172.16.192.0/18, it will be dropped or a destination unreachable ICMP message will be sent back at the routers of AS2 (not AS1 as before), because 172.16.192.0/18 would not be in the routing table."
475,"The RFC 1771 (A Border Gateway Protocol 4 (BGP-4)) planned the coding of AS numbers on 16 bits, for 64510 possible public AS, since ASN 64512 to 65534 were reserved for private use (0 and 65535 being forbidden)."
476,"In 2011, only 15000 AS numbers were still available, and projections[33] were envisioning a complete depletion of available AS numbers in September 2013."
477,"RFC 6793 extends AS coding from 16 to 32 bits (keeping the 16 bits AS range 0 to 65535, and its reserved AS numbers), which now allows up to 4 billion available AS."
478,"An additional private AS range is also defined in RFC 6996 (from 4200000000 to 4294967294, 4294967295 being forbidden by RFC 7300)."
479,"To allow the traversal of router groups not able to manage those new ASNs, the new attribute OT AS4_PATH is used."
480,32-bit ASN assignments started in 2007.
481,Another factor causing this growth of the routing table is the need for load balancing of multi-homed networks.
482,"It is not a trivial task to balance the inbound traffic to a multi-homed network across its multiple inbound paths, due to limitation of the BGP route selection process."
483,"For a multi-homed network, if it announces the same network blocks across all of its BGP peers, the result may be that one or several of its inbound links become congested while the other links remain under-utilized, because external networks all picked that set of congested paths as optimal."
484,"Like most other routing protocols, BGP does not detect congestion."
485,"To work around this problem, BGP administrators of that multihomed network may divide a large contiguous IP address block into smaller blocks and tweak the route announcement to make different blocks look optimal on different paths, so that external networks will choose a different path to reach different blocks of that multi- homed network."
486,Such cases will increase the number of routes as seen on the global BGP table.
487,One method growing in popularity to address the load balancing issue is to deploy BGP/LISP (Locator/Identifier Separation Protocol) gateways within an Internet exchange point to allow ingress traffic engineering across multiple links.
488,This technique does not increase the number of routes seen on the global BGP table.
489,"By design, routers running BGP accept advertised routes from other BGP routers by default."
490,"This allows for automatic and decentralized routing of traffic across the Internet, but it also leaves the Internet potentially vulnerable to accidental or malicious disruption, known as BGP hijacking."
491,"Due to the extent to which BGP is embedded in the core systems of the Internet, and the number of different networks operated by many different organizations which collectively make up the Internet, correcting this vulnerability (such as by introducing the use of cryptographic keys to verify the identity of BGP routers) is a technically and economically challenging problem."
492,"[34]  An extension to BGP is the use of multipathing – this typically requires identical MED, weight, origin, and AS-path although some implementations provide the ability to relax the AS-path checking to only expect an equal path length rather than the actual AS numbers in the path being expected to match too."
493,This can then be extended further with features like Cisco's dmzlink-bw which enables a ratio of traffic sharing based on bandwidth values configured on individual links.
494,"Multiprotocol Extensions for BGP (MBGP), sometimes referred to as Multiprotocol BGP or Multicast BGP and defined in IETF RFC 4760, is an extension to (BGP) that allows different types of addresses (known as address families) to be distributed in parallel."
495,"Whereas standard BGP supports only IPv4 unicast addresses, Multiprotocol BGP supports IPv4 and IPv6 addresses and it supports unicast and multicast variants of each."
496,Multiprotocol BGP allows information about the topology of IP multicast-capable routers to be exchanged separately from the topology of normal IPv4 unicast routers.
497,"Thus, it allows a multicast routing topology different from the unicast routing topology."
498,"Although MBGP enables the exchange of inter-domain multicast routing information, other protocols such as the Protocol Independent Multicast family are needed to build trees and forward multicast traffic."
499,"Multiprotocol BGP is also widely deployed in case of MPLS L3 VPN, to exchange VPN labels learned for the routes from the customer sites over the MPLS network, in order to distinguish between different customer sites when the traffic from the other customer sites comes to the Provider Edge router (PE router) for routing."
500,BGP4 is standard for Internet routing and required of most Internet service providers (ISPs) to establish routing between one another.
501,Very large private IP networks use BGP internally.
502,"An example is the joining of a number of large Open Shortest Path First (OSPF) networks, when OSPF by itself does not scale to the size required."
503,"Another reason to use BGP is multihoming a network for better redundancy, either to multiple access points of a single ISP or to multiple ISPs."
504,"Routers, especially small ones intended for Small Office/Home Office (SOHO) use, may not include BGP software."
505,Some SOHO routers simply are not capable of running BGP / using BGP routing tables of any size.
506,"Other commercial routers may need a specific software executable image that contains BGP, or a license that enables it."
507,"Open source packages that run BGP include GNU Zebra, Quagga, OpenBGPD, BIRD, XORP, and Vyatta."
508,"Devices marketed as Layer 3 switches are less likely to support BGP than devices marketed as routers, but high-end Layer 3 Switches usually can run BGP."
509,"Products marketed as switches may or may not have a size limitation on BGP tables, such as 20,000 routes, far smaller than a full Internet table plus internal routes."
510,"These devices, however, may be perfectly reasonable and useful when used for BGP routing of some smaller part of the network, such as a confederation-AS representing one of several smaller enterprises that are linked, by a BGP backbone of backbones, or a small enterprise that announces routes to an ISP but only accepts a default route and perhaps a small number of aggregated routes."
511,A BGP router used only for a network with a single point of entry to the Internet may have a much smaller routing table size (and hence RAM and CPU requirement) than a multihomed network.
512,Even simple multihoming can have modest routing table size.
513,See RFC 4098 for vendor-independent performance parameters for single BGP router convergence in the control plane.
514,The actual amount of memory required in a BGP router depends on the amount of BGP information exchanged with other BGP speakers and the way in which the particular router stores BGP information.
515,"The router may have to keep more than one copy of a route, so it can manage different policies for route advertising and acceptance to a specific neighboring AS."
516,The term view is often used for these different policy relationships on a running router.
517,"If one router implementation takes more memory per route than another implementation, this may be a legitimate design choice, trading processing speed against memory."
518,"A full IPv4 BGP table as of August 2015 is in excess of 590,000 prefixes."
519,[25] Large ISPs may add another 50% for internal and customer routes.
520,"Again depending on implementation, separate tables may be kept for each view of a different peer AS."
